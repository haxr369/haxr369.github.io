---
title: ORM 개념 정리
date: '2023-10-19'
lastmod: '2023-10-19'
tags: ['db', 'orm', 'jdbc']
draft: false
summary: '관계형 DB는 객체를 테이블 형태로 데이터를 저장하지만, 실제 객체는 그렇지 않다. 그럼 어떻게 이 둘을 맵핑할 수 있을까?'
---

## 목차

<TOCInline toc={props.toc} exclude="목차" toHeading={(2, 3)} />

## ORM의 개념

Object Relational Mapping(ORM)은 애플리케이션과 데이터베이스 사이에서 데이터베이스 연결시 SQL을 사용하는 것이 아니라 애플리케이션 언어로 접근할 수 있도록 하고, 복잡한 구조의 객체를 2차원 행렬 구조의 데이터베이스에 적재할 수 있도록 맵핑할 수 있다.
JPA는 java ORM의 표준 API이고, Java 애플리케이션과 JDBC 사이에서 동작한다.

정리하면 ORM(JPA)은 객체-테이블 맵핑과 메서드-SQL문 맵핑을 수행하고, JDBC는 애플리케이션과 DB 간 연결을 관리하고 JPA로 변환한 요청들을 DB로 보내고 응답받아서 애플리케이션에게 제공한다.

## JDBC의 위치와 WAS와 DB가 연결되는 구조

<img alt="db와 was까지 연결하는 구조" src="/static/images/db/db-was-structure.png" />

JDBC 드라이버는 JDBC 인터페이스를 구현한 구현체이며, 위 그림의 DB와 드라이버의 색이 동일한 것처럼 DB에 맞는 JDBC 드라이버가 필요하고, 모든 JDBC 드라이버를 관리하는 것을 드라이버 매니저라고한다.

드라이버 매니저는 드라이버를 사용해서 DB와 연결을 획득하고 연결을 통해서 SQL 명령어를 요청하고 응답받을 수 있다.

## connection pool

드라이버가 SQL 명령을 DB에 요청하기위해 연결을 매번 획득하는데는 오버헤드가 발생하기 때문에 이를 방지하고자 connection pool을 사용하여 리소스를 효율적으로 사용할 수 있다.

connection pool은 미리 만들어둔 연결들을 모아둔 저장소고, 데이터 소스가 이를 제공한다.

애플리케이션은 직접 DB에 연결을 요청하지 않고 JNDI Lookup을 통해 DB와 연결되 데이터 소스의 연결을 요청한다.
연결을 요청 받은 데이터소스는 connection pool에서 연결을 꺼내서 응답한다. 애플리케이션이 연결을 다 사용하면, 데이터 소스는 연결을 회수해서 이후에 재사용할 수 있도록 connection pool에 넣어 관리한다.

당연하게 DB와 애플리케이션 사이의 연결은 메모리가 필요한 작업이고 여러개를 동시에 사용하면 DB 서버에 부하가 많이 발생할 수 있다. 이를 방지하기 위해 connection 수를 적절하게 설정할 수 있다.
