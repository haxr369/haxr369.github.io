---
title: Transaction에서 MVCC
date: '2023-12-07'
lastmod: '2023-12-07'
tags: ['db', 'Transaction', 'lock', 'MVCC', 'concurrent-programming', 'jpa']
draft: false
summary: '많은 RDBMS에서 transaction 격리를 위해 사용하는 MVCC에 대해 알아보자'
---

## 목차

<TOCInline toc={props.toc} exclude="목차" toHeading={(2, 3)} />

이번 포스팅은 transaction Lock을 보안하기 위한 2 phase locking 프로토콜에대해 정리한다.
쓰레드의 동시성 문제를 해결하기 위해 [ReentrantLock](/blog/java/java-thread2#lock과-condition을-이용한-동기화)을 사용한 것처럼
DB도 transaction 간의 데이터 접근을 막기 위해서 **lock**을 사용한다.

## DB에서 lock이란

DB에서 lock이란 [쓰레드의 lock](/blog/java/java-thread1#쓰레드와-동기화)처럼 한 transaction이 한 데이터의 read나 write lock을 가지고 있다면,
그 데이터가 unlock될 때까지 다른 transaction이 read, write 작업을 하지 못하는 것을 의미한다.

transaction 간의 데이터 접근을 **제한**하지만, lock만으로는 완전한 **SERIALIZABLE** 격리 상태를 만들 수 없다.
SERIALIZABLE 격리 상태는 같은 데이터를 사용하는 두 transaction은 무조건 순차적으로 데이터를 업데이트해야하기 때문이고,
lock은 데이터를 막지만, unlock되면 끝이기 때문에 순서를 **제한**할 수 없다.

## MVCC란
