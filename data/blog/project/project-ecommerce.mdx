---
title: 이커머스 ERD 설계와 구현
date: 2023-10-18
lastmod: 2023-10-18
tags: ['db', 'ERD', 'SQL', 'Mysql']
draft: false
summary: '쿠팡 이커머스에서 상품 조회, 주문, 결제, 그리고 리뷰 서비스에 대한 ERD 다이어그램을 설계하고 SQL로 구현하는 과정'
---

## 목차

<TOCInline toc={props.toc} exclude="목차" toHeading={2} />

## 개요

ASAC 12주차에 쿠팡 커머스 ERD 설계와 SQL로 구현하는 과제가 나왔다. 다만, 쿠팡의 핵심 서비스인 상품 조회, 주문, 결제, 배송과 관련된 기능 위주로 ERD 설계하도록 제한했다.

다음과 같은 요구사항을 바탕으로 ERD를 설계해야한다.

```
- 이용자는 크게 고객과 판매자로 구분된다.
- 상품 카테고리는 최대 2개의 계층으로 설계한다.
- 하나의 상품은 여러 판매자가 판매할 수 있다.
- 하나의 상품은 다양한 옵션, 개수로 판매할 수 있다.
- 판매자는 상품 게시글을 여러 개 등록할 수 있다.
- 고객은 상품 게시글을 보고 상품 옵션을 여러 개 선택하여 주문할 수 있다.
- 고객이 주문한 이후 상품 내용이 바뀌더라도 주문 내용은 바뀌어서는 안된다.
- 고객은 주문 이후 결제 정보를 확인할 수 있어야 한다.
- 고객은 주문 이후 배송 정보를 확인할 수 있어야 한다.
- 고객은 구매한 상품에 대해 상품평을 남길 수 있어야 한다.
- 각각의 관계는 PK, FK로 표현되어야 한다.
- 쿠팡의 핵심 기능 외 복잡성을 증가시키는 기능은 설계에서 제외한다.
```

## ERD 설계에서

이커머스 시스템과 상호작용하는 액터는 사용자와 판매자 뿐이다. 대부분 엔티티는 이 두 엔티티에 종속된다.

Product 엔티티와 Product Option 엔티티가 나뉘어진 이유는 한 상품이라도 색상, 묶음, 사이즈 등등 많은 옵션을 가질 수 있고, 사용자는 그런 옵션을 고를 수 있어야하기 때문에 한 상품이 여러 옵션을 가질 수 있도록 엔티티를 나눴다.

마찬가지로, Order 엔티티와 DetailOrder 엔티티가 나뉘어진 이유도 동일한 배송 정보를 가진 한 주문 안에 여러 다른 상품이 있을 수 있기 때문이다.

<img alt="이커머스 ERD 설계" src="/static/images/project/project-erd.png" width="1500" />

## 서비스를 위한 쿼리 작성해보기

1. [상품 디테일 페이지](https://www.coupang.com/vp/products/7400323975?itemId=19153028948&vendorItemId=86292117392&q=%EB%A7%A5%EB%B6%81+%EC%97%90%EC%96%B4+15%EC%9D%B8%EC%B9%98&itemsCount=36&searchId=a2a666a1b1ff489cb15fac21a1647006&rank=1&isAddedCart=)

   - 상품 디테일 정보 조회 쿼리
     - ERD를 참고했을 때, 상품 디테일 페이지를 구성할 때 상품 엔티티이외에 필요한 엔티티는 상품 컨텐츠와 상품 옵션이 필요하다.
     - 따라서 ProductContent와 ProductOption에서 상품 id로 Product와 join해야한다.

   ```sql:productDetail.sql



   ```

   - 상품평 조회 쿼리

   ```sql:productDetail.sql



   ```

   - 상품 구매 추가 쿼리

   ```sql:productDetail.sql



   ```
